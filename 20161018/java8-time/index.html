<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Better Java (1)- JDK8中有关时间的操作 | 付啸的个人网站</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Better Java (1)- JDK8中有关时间的操作</h1><a id="logo" href="/.">付啸的个人网站</a><p class="description">var me = 程序员 &amp;&amp; 吃货</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Better Java (1)- JDK8中有关时间的操作</h1><div class="post-meta">Oct 18, 2016<span> | </span><span class="category"><a href="/categories/Java/">Java</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Better-Java-1-JDK8中有关时间的操作"><span class="toc-number">1.</span> <span class="toc-text">Better Java (1)- JDK8中有关时间的操作</span></a></li></ol></div></div><div class="post-content"><h2 id="Better-Java-1-JDK8中有关时间的操作"><a href="#Better-Java-1-JDK8中有关时间的操作" class="headerlink" title="Better Java (1)- JDK8中有关时间的操作"></a>Better Java (1)- JDK8中有关时间的操作</h2><p>今天读了<a href="https://github.com/cxxr/better-java/blob/master/README.zh-cn.md" target="_blank" rel="noopener">Better Java</a>一文, 之前在项目中有关时间的操作基本上都是使用<code>Calendar</code>, 这次学习一下<a href="http://www.oracle.com/technetwork/articles/java/jf14-date-time-2125367.html" target="_blank" rel="noopener">JDK8有关时间的操作</a>.</p>
<p><code>LocalDate</code>操作日期, 如年月日, 不包含时分秒. <code>LocalTime</code>操作时分秒, 不包含年月日. <code>LocalDateTime</code>最为强大, 包含了年月日时分秒. 看内部实现, 其内部包含<code>LocalDate</code>和<code>LocalTime</code>两个对象, 三个类的用法都差不多.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">LocalDateTime timePoint = LocalDateTime.now(); <span class="comment">// 当前日期和时间,</span></span><br><span class="line">System.out.println(timePoint); <span class="comment">// 输出: 2016-10-18T16:51:14.334</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取年月日时分秒毫秒</span></span><br><span class="line">System.out.println(timePoint.getYear() + <span class="string">"年"</span></span><br><span class="line">   + timePoint.getMonthValue() + <span class="string">"月"</span></span><br><span class="line">   + timePoint.getDayOfMonth() + <span class="string">"日, 星期"</span> + timePoint.getDayOfWeek().getValue() + <span class="string">","</span></span><br><span class="line">   + timePoint.getHour() + <span class="string">"时"</span></span><br><span class="line">   + timePoint.getMinute() + <span class="string">"分"</span></span><br><span class="line">   + timePoint.getSecond() + <span class="string">"秒"</span></span><br><span class="line">   + timePoint.getNano() + <span class="string">"毫秒"</span>);</span><br></pre></td></tr></table></figure>
<p>如何生成特定日期的? 可通过 <code>LocalDateTime.of()</code>类方法生成, 或者通过已<code>with</code>及<code>plus</code>开头的实例方法来生成. <code>with</code>开头的实例方法根据参数生成指定日期, <code>plus</code>开头的实例方法根据参数推断日期.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生成一个指定日期: 2015年10月10日0点0分0秒</span></span><br><span class="line">LocalDateTime timePoint = LocalDateTime.of(<span class="number">2016</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">System.out.println( <span class="string">"timePoint = "</span> + timePoint); <span class="comment">// 输出: timePoint = 2016-10-10T00:00</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过plus开头的实例方法, 推断日期, 天数减8, 小时加2, 周减1</span></span><br><span class="line">LocalDateTime yetAnther = timePoint.plusDays(-<span class="number">8</span>).plusHours(<span class="number">2</span>).plus(-<span class="number">1</span>, ChronoUnit.WEEKS);</span><br><span class="line">System.out.println(<span class="string">"yetAnther = "</span> + yetAnther); <span class="comment">// 输出: yetAnther = 2016-09-25T02:00</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以通过具体逻辑生成指定日期, plus也有如下方法</span></span><br><span class="line">yetAnther = timePoint.with(temporal</span><br><span class="line">   -&gt; temporal.plus(-<span class="number">1</span>, ChronoUnit.MONTHS).with(ChronoField.YEAR, <span class="number">2015</span>));</span><br><span class="line">System.out.println(yetAnther); <span class="comment">// 输出: yetAnther = 2015-09-10T00:00</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>LocalDateTime</code>, <code>LocalDate</code>, <code>LocalTime</code>都是不可变对象, 也就是说通过它们的API得到的时间都是不会改变自己的值, 都是用自身的时间点计算得到的结果. 如代码最后一个方法, 是根据<code>timePoint</code>对象生成的时间<code>2016-10-10 00:00:00</code>生成指定日期的.</p>
</blockquote>
<p>有时我们需要不同精度的时间, 比如, 我只需要年月, 不需要日时分秒, 怎么办?</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 转换到所需的时间精度</span></span><br><span class="line">timePoint = LocalDateTime.of(<span class="number">2016</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">23</span>, <span class="number">59</span>, <span class="number">59</span>, <span class="number">3</span>);</span><br><span class="line">System.out.println(<span class="string">"时间 : "</span> + timePoint);</span><br><span class="line">LocalDateTime truncatedTime = timePoint.truncatedTo(ChronoUnit.DAYS);</span><br><span class="line">System.out.println(<span class="string">"时间精度到天: "</span> + truncatedTime);</span><br><span class="line">truncatedTime = timePoint.truncatedTo(ChronoUnit.HOURS);</span><br><span class="line">System.out.println(<span class="string">"时间精度到小时: "</span> + truncatedTime);</span><br><span class="line">truncatedTime = timePoint.truncatedTo(ChronoUnit.MINUTES);</span><br><span class="line">System.out.println(<span class="string">"时间精度到分钟: "</span> + truncatedTime);</span><br><span class="line">truncatedTime = timePoint.truncatedTo(ChronoUnit.SECONDS);</span><br><span class="line">System.out.println(<span class="string">"时间精度到秒: "</span> + truncatedTime);</span><br><span class="line">truncatedTime = timePoint.truncatedTo(ChronoUnit.NANOS);</span><br><span class="line">System.out.println(<span class="string">"时间精度到毫秒: "</span> + truncatedTime);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>时间精度最大到天, 不能在大于此精度. 否则会抛出异常: <code>UnsupportedTemporalTypeException: Unit is too large to be used for truncation</code></p>
</blockquote>
<p>有时我们会对时间做时区处理, 根据本地时间, 推算某个时区的时间, 怎么办? 这里主要用到两个对象: <code>OffsetDateTime</code>和<code>ZoneOffset</code>.</p>
<p>使用<code>OffsetDateTime</code>获取时区时间, 使用方法与<code>localDateTaime</code>类似. 使用<code>ZoneOffset</code>对象生成时区. 两个对象配合, 即可获取我们想要的时区时间. 下面有两个重要的方法<code>withOffsetSameInstant</code>和<code>withOffsetSameLocal</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">OffsetDateTime time = OffsetDateTime.now(); <span class="comment">// 这个是系统当前时间</span></span><br><span class="line">System.out.println(<span class="string">"当前时区时间 = "</span> + time);</span><br><span class="line"></span><br><span class="line">time = OffsetDateTime.of(<span class="number">2016</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">59</span>, <span class="number">59</span>, <span class="number">0</span>, ZoneOffset.of(<span class="string">"+08:00"</span>));</span><br><span class="line">System.out.println(<span class="string">"指定时区的指定时间 = "</span> + time);</span><br><span class="line"></span><br><span class="line">ZoneOffset offset = ZoneOffset.of(<span class="string">"+09:00"</span>); <span class="comment">// 生成指定时区</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 用自身时间计算指定时区的时间.</span></span><br><span class="line">OffsetDateTime offsetTime1 = time.withOffsetSameInstant(offset);</span><br><span class="line"></span><br><span class="line"><span class="comment">// offsetTime1 = 2016-10-10T13:59:59+09:00</span></span><br><span class="line">System.out.println(<span class="string">"offsetTime1 = "</span> + offsetTime1);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将自身时间的时区更换为指定时区, 时间不变</span></span><br><span class="line">OffsetDateTime offsetTime2 = time.withOffsetSameLocal(offset);</span><br><span class="line"></span><br><span class="line"><span class="comment">// offsetTime2 = 2016-10-10T12:59:59+09:00</span></span><br><span class="line">System.out.println(<span class="string">"offsetTime2 = "</span> + offsetTime2);</span><br><span class="line"></span><br><span class="line"><span class="comment">// API与LocalDateTime对象类似</span></span><br><span class="line">OffsetDateTime offsetTime3 = offsetTime2.withHour(<span class="number">3</span>).plusSeconds(<span class="number">2</span>);</span><br><span class="line">System.out.println(<span class="string">"offsetTime3 = "</span> + offsetTime3);</span><br></pre></td></tr></table></figure>
<p>JDK8还提供了两个非常方便的对象, 让我们来计算时间. <code>Period</code>和<code>Duration</code>. 根据这两个参数非常方便推算出我们想要的时间. <code>Period</code>用于推算年月日, 最低精度到天, <code>Duration</code>用于推算天时分秒, 最低精度到毫秒.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Period period = Period.of(<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>); <span class="comment">// 3年, 2月, 1天</span></span><br><span class="line">LocalDateTime now = LocalDateTime.now();</span><br><span class="line">LocalDateTime periodTime = now.plus(period);</span><br><span class="line">System.out.println(<span class="string">"now = "</span> + now);</span><br><span class="line">System.out.println(<span class="string">"periodTime = "</span> + periodTime);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Durations</span></span><br><span class="line">Duration duration = Duration.ofSeconds(<span class="number">3</span>, <span class="number">5</span>);</span><br><span class="line">LocalDateTime durationTime = now.plus(duration);</span><br><span class="line">System.out.println(<span class="string">"dutationTime = "</span> + durationTime);</span><br></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/Java/">Java</a></div><div class="post-nav"><a class="pre" href="/20170101/https/">2017年的第一天, 给自己的网站加个&quot;S&quot;</a><a class="next" href="/20161017/hexo-optimization/">hexo优化</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="https://www.fuxiao86.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂谈/">杂谈</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/https/" style="font-size: 15px;">https</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/20170723/new-web/">备案, 重新搭建</a></li><li class="post-list-item"><a class="post-list-link" href="/20170221/Java8实战读书笔记/">Java8实战读书笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/20170101/Docker学习/">Docker学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/20170101/https/">2017年的第一天, 给自己的网站加个"S"</a></li><li class="post-list-item"><a class="post-list-link" href="/20161018/java8-time/">Better Java (1)- JDK8中有关时间的操作</a></li><li class="post-list-item"><a class="post-list-link" href="/20161017/hexo-optimization/">hexo优化</a></li><li class="post-list-item"><a class="post-list-link" href="/20161016/first/">网站开通</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">付啸的个人网站.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>